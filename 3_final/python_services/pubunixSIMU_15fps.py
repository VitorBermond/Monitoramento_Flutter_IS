import pika
import json
import time
from datetime import datetime

# Conexão com RabbitMQ
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Filas
filas = {
    "FPS": "Data.FPS",
    "ET": "Data.TE",
    "PT": "Data.PT",
    "SPEED": "Data.SPEED",
    "CPU": "Data.CPU",
    "GPU": "Data.GPU"
}

for fila in filas.values():
    channel.queue_declare(queue=fila)

# ---------- DADOS DEFINIDOS MANUALMENTE ----------

fps_list = [15] * 120

et_list = [
    300, 320, 340, 360, 390, 420, 424, 427, 427, 422,
    418.12, 409.23, 400.35, 391.47, 382.58, 373.7, 364.81, 355.93, 347.05,
    338.16, 329.28, 320.4, 311.51, 302.63, 293.74, 284.86, 275.98, 267.09, 258.21,
    249.33, 240.44, 231.56, 222.67, 213.79, 204.91, 196.02, 187.14, 178.26, 169.37,
    160.49, 151.6, 140, 129.84, 116.95, 102.07, 94.19, 85.3, 73.42, 62.53,
    47.39, 38.49, 36.90, 28.80, 22.50, 12.60, 9.00, 10.80, 13.50, 9.90,
    35.10, 30.60, 18.90, 18.90, 37.80, 58.50, 68.40, 45.00, 49.50, 43.20,
    39.60, 37.80, 36.00, 41.40, 41.40, 44.10, 37.80, 44.10, 48.60, 52.20,
    59.40, 58.50, 54.00, 52.20, 49.50, 47.70, 54.00, 60.30, 68.40, 77.40,
    86.40, 97.20, 103.50, 111.70, 123.32, 135.90, 139.50, 132.30, 126.00, 119.00,
    109.80, 103.50, 99.26, 90.57, 84.46, 75.03, 68.08, 61.20, 48.60, 39.88,
    37.80, 33.74, 29.16, 26.19, 40.50, 48.60, 38.70, 38.29, 33.04, 23.65, 22.55

]

pt_list = [
    0.60362, 0.60491, 0.56528, 0.55377, 0.59429, 0.5524, 0.59439, 0.57613, 0.57058, 0.60122,
    0.5635, 0.59883, 0.56261, 0.5997, 0.59796, 0.57914, 0.5911, 0.5831, 0.5748, 0.60474,
    0.56229, 0.56348, 0.58448, 0.59992, 0.5989, 0.56711, 0.55563, 0.59511, 0.59186, 0.55597,
    0.57117, 0.60252, 0.57014, 0.55868, 0.57131, 0.59868, 0.56055, 0.56053, 0.56196, 0.59265,
    0.59006, 0.59107, 0.5917, 0.60328, 0.5842, 0.58888, 0.5628, 0.56226, 0.59753, 0.56101,
    0.59289, 0.6017, 0.56315, 0.56926, 0.58841, 0.60344, 0.55379, 0.59799, 0.55987, 0.57947,
    0.58864, 0.57194, 0.56452, 0.59802, 0.55745, 0.57846, 0.58445, 0.5834, 0.56586, 0.5567,
    0.55468, 0.56685, 0.58012, 0.58452, 0.60169, 0.56066, 0.55384, 0.59796, 0.58227, 0.5618,
    0.5724, 0.59012, 0.5789, 0.56663, 0.57099, 0.55912, 0.58273, 0.55646, 0.58644, 0.60373,
    0.56573, 0.60225, 0.5869, 0.57888, 0.57356, 0.56711, 0.59424, 0.55909, 0.56544, 0.56557,
    0.5738, 0.59059, 0.58969, 0.58452, 0.57004, 0.59697, 0.59663, 0.56968, 0.55563, 0.56273,
    0.56313, 0.60359, 0.55684, 0.56196, 0.5595, 0.59988, 0.56679, 0.58491, 0.5763, 0.60368
]

speed_list = [
  348, 348, 349, 348, 348, 349, 349, 349, 349, 349,  
  350, 352, 355, 360, 370, 390, 415, 440, 470, 500,  
  535, 560, 580, 570, 555, 535, 510, 485, 460, 435,  
  415, 400, 385, 375, 368, 360, 355, 350, 348, 347, 
  346, 345, 345, 345, 345, 345, 345, 345, 345, 345,  
  346, 347, 348, 350, 352, 355, 360, 370, 385, 400,  
  420, 440, 460, 480, 505, 525, 540, 550, 545, 530,  
  510, 485, 465, 445, 425, 410, 395, 385, 375, 365,
  358, 352, 348, 345, 344, 343, 342, 342, 342, 342,
  342, 343, 344, 345, 346, 347, 347, 348, 348, 348,
  347, 346, 345, 345, 344, 344, 343, 343, 342, 342,
  342, 342, 342, 342, 342, 342, 342, 342, 342, 342
]

cpu_list = [
60.44, 56.73, 59.07, 61.84, 62.71, 60.88, 58.03, 63.92, 55.85, 61.32,
58.76, 59.41, 60.15, 59.86, 55.37, 63.11, 56.45, 60.17, 58.80, 59.93,
62.24, 57.96, 61.79, 59.38, 56.11, 64.28, 60.07, 61.20, 63.30, 57.55,
60.12, 55.65, 59.59, 60.03, 61.56, 63.15, 57.61, 60.32, 62.66, 55.12,
58.94, 59.83, 61.48, 57.84, 63.74, 60.77, 58.02, 61.97, 59.27, 60.49,
60.62, 55.41, 63.02, 58.38, 59.69, 60.95, 62.84, 57.71, 56.31, 64.16,
58.50, 59.62, 61.41, 60.80, 56.90, 61.90, 58.09, 57.23, 64.40, 59.06,
59.75, 63.63, 55.34, 60.91, 62.02, 60.26, 58.61, 55.18, 63.27, 61.03,
59.20, 60.51, 60.17, 58.47, 63.48, 55.94, 60.66, 58.23, 61.35, 59.94,
59.00, 62.98, 56.16, 60.13, 59.88, 62.12, 58.43, 56.67, 60.85, 61.10,
59.16, 58.67, 64.65, 56.84, 60.68, 59.02, 60.43, 60.32, 61.66, 58.92,
57.48, 63.40, 57.15, 60.72, 58.18, 64.23, 59.43, 57.33, 61.52, 60.00
]


gpu_list = [
    92.38, 88.12, 91.24, 94.76, 93.53, 95.28, 90.35, 92.76, 93.90, 92.01,
    92.58, 94.18, 91.86, 92.72, 88.47, 95.25, 89.87, 92.00, 93.42, 90.55,
    91.03, 93.21, 90.49, 91.98, 94.05, 91.51, 89.36, 95.88, 90.08, 91.45,
    94.72, 95.66, 88.23, 92.26, 94.45, 90.77, 92.36, 90.96, 93.13, 91.57,
    92.79, 92.01, 89.15, 91.02, 95.35, 94.40, 93.57, 90.26, 92.91, 88.79,
    93.76, 89.21, 92.64, 91.68, 93.09, 92.13, 90.63, 95.84, 92.29, 88.93,
    92.50, 95.16, 90.21, 94.67, 93.36, 88.65, 92.43, 91.92, 93.27, 90.39,
    89.78, 95.12, 91.06, 92.35, 93.79, 88.88, 94.31, 92.45, 94.85, 89.68,
    91.22, 95.44, 91.78, 93.06, 92.12, 92.27, 91.94, 90.04, 95.30, 92.99,
    91.99, 93.15, 89.60, 90.17, 94.12, 95.55, 93.33, 88.56, 90.91, 95.62,
    92.19, 93.90, 90.11, 92.76, 91.29, 89.92, 93.63, 91.85, 90.47, 95.21,
    89.74, 94.59, 88.34, 94.95, 90.32, 92.62, 93.72, 91.40, 92.08, 91.73
]



num_pontos = len(fps_list)

# ---------- LOOP DE PUBLICAÇÃO ----------

i = 0
while i < num_pontos:
    timestamp = int(time.time())

    mensagens = {
        "FPS":   {"FPS": fps_list[i], "timestamp": timestamp},
        "ET":    {"trajectory_error": et_list[i], "timestamp": timestamp},
        "PT":    {"tags": {"Tempo de Processamento (ms)": pt_list[i]}, "timestamp": timestamp},
        "SPEED": {"speed": speed_list[i], "timestamp": timestamp},
        "CPU":   {"cpu_usage": cpu_list[i], "timestamp": timestamp},
        "GPU":   {"gpu_usage": gpu_list[i], "timestamp": timestamp},
    }

    for chave, payload in mensagens.items():
        channel.basic_publish(
            exchange='',
            routing_key=filas[chave],
            body=json.dumps(payload)
        )

    print(f"[{datetime.fromtimestamp(timestamp)}] Publicado ponto {i+1}/{num_pontos}")
    
    i = (i + 1)
    #time.sleep(1/2.5)
