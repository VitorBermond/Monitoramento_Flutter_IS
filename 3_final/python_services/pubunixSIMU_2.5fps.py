import pika
import json
import time
from datetime import datetime

# Conexão com RabbitMQ
connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

# Filas
filas = {
    "FPS": "Data.FPS",
    "ET": "Data.TE",
    "PT": "Data.PT",
    "SPEED": "Data.SPEED",
    "CPU": "Data.CPU",
    "GPU": "Data.GPU"
}

for fila in filas.values():
    channel.queue_declare(queue=fila)

# ---------- DADOS DEFINIDOS MANUALMENTE ----------

fps_list = [2.5] * 120

et_list = [
    300, 320, 340, 360, 390, 420, 424, 427, 427, 422,
    418.12, 409.23, 400.35, 391.47, 382.58, 373.7, 364.81, 355.93, 347.05,
    338.16, 329.28, 320.4, 311.51, 302.63, 293.74, 284.86, 275.98, 267.09, 258.21,
    249.33, 240.44, 231.56, 222.67, 213.79, 204.91, 196.02, 187.14, 178.26, 169.37,
    160.49, 151.6, 140, 129.84, 116.95, 102.07, 94.19, 85.3, 73.42, 62.53,
    52.65, 42.77, 41, 55.0, 67, 78, 70, 101, 122, 142,
    162.63, 172.85, 183.46, 186.27, 185.06, 173, 154, 123, 101, 85,
    63, 50, 65, 87, 123, 155, 187, 198, 210, 229,
    256, 278, 300, 328, 352, 380, 397, 413, 430, 434,
    421, 380, 354.0, 340.11, 310.02, 280, 254, 232.56, 211.03, 245.2,
    288.51, 317, 346.29, 360.63, 378.84, 399.37, 416.64, 435, 441, 449.31,
    422, 400.49, 378.4, 361, 346.04, 321.63, 310.32, 298.54, 277.71, 263.28, 254.05
]

pt_list = [0.05421, 0.04807, 0.05057, 0.05005, 0.05518, 0.05459, 0.05674, 0.04869, 0.05204, 0.04812,
           0.05001, 0.05287, 0.04809, 0.04981, 0.05432, 0.05327, 0.05002, 0.05371, 0.05591, 0.04788,
           0.05588, 0.0548,  0.05122, 0.04937, 0.05739, 0.05119, 0.04875, 0.04879, 0.05629, 0.05386,
           0.05589, 0.05512, 0.05318, 0.05755, 0.05161, 0.05334, 0.05611, 0.05401, 0.05644, 0.05359,
           0.05487, 0.04828, 0.0501,  0.05071, 0.04862, 0.05015, 0.04883, 0.0506,  0.05418, 0.05147,
           0.05152, 0.04992, 0.05049, 0.05719, 0.0543,  0.05391, 0.04953, 0.05511, 0.04945, 0.05161,
           0.05772, 0.05422, 0.05339, 0.05467, 0.05625, 0.05558, 0.05011, 0.04814, 0.05097, 0.0505,
           0.04993, 0.05725, 0.05658, 0.05097, 0.05437, 0.05178, 0.05697, 0.05241, 0.05047, 0.05029,
           0.05343, 0.05045, 0.05367, 0.0568,  0.05181, 0.05001, 0.0578,  0.05292, 0.04873, 0.04829,
           0.04892, 0.05409, 0.05574, 0.05204, 0.04846, 0.05164, 0.05778, 0.05311, 0.05753, 0.05643,
           0.04793, 0.05503, 0.05464, 0.05319, 0.05049, 0.05423, 0.04894, 0.05217, 0.05236, 0.05736,
           0.05658, 0.05045, 0.05283, 0.04961, 0.05695, 0.05653, 0.0508, 0.05421, 0.05391, 0.04935
           ]

speed_list = [
  348, 348, 349, 348, 348, 349, 349, 349, 349, 349,  
  350, 352, 355, 360, 370, 390, 415, 440, 470, 500,  
  535, 560, 580, 570, 555, 535, 510, 485, 460, 435,  
  415, 400, 385, 375, 368, 360, 355, 350, 348, 347, 
  346, 345, 345, 345, 345, 345, 345, 345, 345, 345,  
  346, 347, 348, 350, 352, 355, 360, 370, 385, 400,  
  420, 440, 460, 480, 505, 525, 540, 550, 545, 530,  
  510, 485, 465, 445, 425, 410, 395, 385, 375, 365,
  358, 352, 348, 345, 344, 343, 342, 342, 342, 342,
  342, 343, 344, 345, 346, 347, 347, 348, 348, 348,
  347, 346, 345, 345, 344, 344, 343, 343, 342, 342,
  342, 342, 342, 342, 342, 342, 342, 342, 342, 342
]

cpu_list = [
    43.17, 38.64, 42.93, 40.77, 39.53, 44.88, 35.80, 39.40, 42.16, 36.12,
    38.05, 43.54, 39.12, 36.81, 41.93, 37.28, 42.43, 39.79, 40.14, 35.92,
    41.00, 39.36, 38.47, 44.03, 37.61, 42.85, 35.44, 39.96, 40.50, 41.34,
    36.27, 43.21, 38.72, 40.89, 37.98, 42.14, 39.26, 35.58, 43.66, 38.30,
    41.77, 40.12, 36.90, 42.58, 39.83, 38.94, 44.05, 37.19, 41.25, 39.62,
    40.48, 35.75, 43.82, 38.69, 41.12, 39.04, 37.84, 42.31, 40.56, 36.43,
    44.15, 38.01, 40.37, 39.88, 41.06, 35.90, 43.57, 38.45, 40.78, 39.19,
    37.76, 42.69, 40.23, 36.59, 43.99, 38.12, 41.34, 39.87, 40.49, 35.82,
    42.53, 38.69, 40.90, 39.25, 37.93, 43.10, 40.61, 36.71, 44.02, 38.30,
    41.06, 39.75, 40.15, 35.79, 43.34, 38.54, 40.45, 39.12, 37.88, 42.80,
    40.36, 36.67, 43.91, 38.04, 41.27, 39.82, 40.03, 35.88, 42.77, 38.45,
    40.59, 39.36, 37.97, 43.15, 40.51, 36.49, 43.74, 38.20, 41.03, 39.69,
]

gpu_list = [8.89,  15.46, 9.94,  13.13, 15.22, 16.43, 13.03, 13.48, 8.69,  12.82,
            12.22, 17.02, 13.97, 16.05, 12.84, 10.26, 17.01, 16.7,  12.26, 9.46,
            13.62, 13.46, 16.22, 14.47, 13.57, 14.25, 12.27, 8.99,  9.11,  17.92,
            16.89, 11.46, 17.39, 13.72, 9.53,  17.06, 14.34, 17.83, 15.29, 9.44,
            14.73, 16.37, 17.49, 11.81, 13.79, 15.51, 10.17, 16.98, 16.31, 9.0,
            14.41, 12.18, 10.36, 14.54, 18.19, 14.02, 9.63,  13.45, 16.29, 18.05,
            15.65, 8.91,  18.17, 14.52, 9.34,  9.77,  9.36,  15.15, 10.04, 16.57,
            9.59,  13.85, 12.93, 8.88,  8.53,  17.54, 18.27, 9.74,  15.85, 18.39,
            17.54, 17.35, 11.88, 15.67, 13.48, 17.87, 15.53, 16.94, 17.07, 12.36,
            15.62, 9.43,  10.56, 17.87, 12.55, 15.35, 14.26, 11.1,  14.36, 17.62,
            11.77, 11.97, 10.36, 10.28, 16.77, 15.56, 18.15, 15.2,  18.09, 10.72,
            10.38, 10.67, 12.34, 18.4,  10.75, 13.08, 9.11,  8.77,  13.96, 14.63
            ]

num_pontos = len(fps_list)

# ---------- LOOP DE PUBLICAÇÃO ----------

i = 0
while i < num_pontos:
    timestamp = int(time.time())

    mensagens = {
        "FPS":   {"FPS": fps_list[i], "timestamp": timestamp},
        "ET":    {"trajectory_error": et_list[i], "timestamp": timestamp},
        "PT":    {"tags": {"Tempo de Processamento (ms)": pt_list[i]}, "timestamp": timestamp},
        "SPEED": {"speed": speed_list[i], "timestamp": timestamp},
        "CPU":   {"cpu_usage": cpu_list[i], "timestamp": timestamp},
        "GPU":   {"gpu_usage": gpu_list[i], "timestamp": timestamp},
    }

    for chave, payload in mensagens.items():
        channel.basic_publish(
            exchange='',
            routing_key=filas[chave],
            body=json.dumps(payload)
        )

    print(f"[{datetime.fromtimestamp(timestamp)}] Publicado ponto {i+1}/{num_pontos}")
    
    i = (i + 1)
    time.sleep(1/2.5)
